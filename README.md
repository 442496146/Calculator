# 简单计算器

## 1 问题描述

随着电子时代的到来，人们越来越倾向于使用电子产品，简便好用的电子软件更是不可或缺。然而手机不在身边的时候，只能使用电脑来代替。但是很多电脑用户并不知道系统中自带了计算器，不知道如何打开使用，那么制作一款简便的计算器软件就显得尤为重要。
本程序基本实现了总基本设计要求，并在基本设计要求上实现了更多功能。计划使用中缀表达式输入，变为后缀表达式计算的算法思想。输入数字字符前，判断前一个字符是不是数字，如果是数字可继续输入，如果是小数点、+、-、*、/等也可继续输入，如果是！、）等不可直接输入。输入非数字字符前，判断前一个字符是不是数字字符、）、！等，如果是，则不可直接输入，如果是+、-、*、/、（ 等可继续输入。在输入非数值字符前，如果前方是数值字符则可继续输入，如果不是数值字符则不可直接输入，前方为（不可直接输入，而）后可继续输入。

## 2 设计要求

(1) 用户从界面上输入数字和运算符等符号；
(2) 可以实现整数、实数的 +、 -、 ×、÷、！、^ 、√、 %运算
(3) 能够一次输入整个计算式，可自动识别计算优先级；
(4) 输入表达式符合规范才能出结果
(5) 百分数转换只可在计算完成后，仅实现数制转换功能。
(6) 回退键每次回退输入框的一个字符，不可回退结果框中数值。
(7) 输入框中内容每次仅可修改最后一位，如果要修改所有内容，按C键重置，重置后结果框中内容也消失，不做保留。
(8) 阶乘号！只能对整数做阶乘运算。
(9) 开根号不能直接在次方后，需要加括号。
(10) 本计算器中所有出现的结果保留小数6位。 

## 3 算法设计思想

### 3.1  按键及其功能实现和输入控制

(1) 输入数字字符 0-9 前，如果已输入为空，此字符可以输入；如果已输入不为空，此字符不能直接接在右括号')'或者圆周率Π'P'或者阶乘符'!'后。

(2) 输入数字字符 P(π) 前，如果已输入为空，此字符可以输入；如果已输入的不为空，'P'不能直接接在右括号')'或者数字0-9或者阶乘符'!'后。
(3) 输入小数点 . 前，如果已输入为空，此字符不可以输入；如果已输入不为空，小数点前面只可能是数字，且一个数字不可能有两个小数点。
(4) 输入算数符 +-*/ 前，如果已输入为空，此字符不可以输入；如果已输入的不为空，加号前面只可能是数字0-9和Π或者右括号')'或者阶乘符'!'。
(5) 输入符号 ( 前，如果已输入为空，此字符可以输入；如果已输入的不为空，此字符不能直接接在数字0-9和Π或者小数点'.'或者右括号')'或者阶乘符'!'后。
(6) 输入符号 ) 前，如果已输入为空，此字符不可以输入；如果已输入的不为空，此字符只能直接接在数字0-9和Π或者小数点'.'或者右括号')'或者阶乘符'!'后。
(7) 输入算数符 S(√) 前，如果已输入为空，此字符可以输入；如果已输入的不为空，此字符只能直接接在加减乘除'+''-''*''/'或者根号'S'或者左括号'('后。
(8) 输入算数符 ^ 前，如果已输入为空，此字符不可以输入；如果已输入的不为空，此字符只能直接接在加减乘除'+''-''*''/'或者根号'S'或者左括号'('后。
(9) 输入算数符 ! 前，如果已输入为空，此字符不可以输入；如果已输入的不为空，此字符阶乘符'!'只能直接接在数字0-9和Π或者右括号')'后。
(10) 左击清除按键 C 后，如果输入框和结果框为空则无需清除；如果不为空则清除输入框和结果框里的内容。
(11) 左击算数符按键 % 后，如果输入的符合初步规范，此表达式正确，可进行计算；如果输入的不符合初步规范，此表达式错误，无法计算。
(12) 左击结果按键后，如果输入的符合初步规范，此表达式正确，可进行计算；如果输入的不符合初步规范，此表达式错误，无法计算。
(13) 左击退格按键后，如果输入框为空则无需清除，如果不为空则退格删除一个输入框里的字符。

### 3.2  初步判断表达式是否符合规范（在表达式输入结束后、处理表达式前完成）

(1) 左括号数=右括号数
(2) 输入的双目运算符数+1=输入的数字个数（非数字字符个数）

### 3.3  处理表达式（先将表达式转换成后缀表达式再计算后缀表达式的值）

计算一个表达式，可以用数据结构中栈的知识，将中缀表达式转为后缀表达式，再将后缀表达式进行计算得到结果。
中缀表达式： 9+(3-1)*3+10/2，就是我们平常计算时的表达式；
后缀表达式： 9 3 1 - 3 * + 10 2 / + ，不包含括号，运算符在两个运算对象后面的表达式。

#### (1) 中缀表达式转后缀表达式

先初始化一个空的栈(Stack)，将这个中缀表达式中的数字（包括π）和运算符(包括加减乘除及左右括号还有次方阶乘开方)分割成一个个字符串存进一个新的数组中，如上面的中缀表达式就存为：9 + ( 3 - 1 ) * 3 + 10 / 2  然后遍历这个数组，运算对象就直接放进一个初始化的字符数组中，栈中存放的是运算符。如果是空栈，加减乘除及左右括号还有次方阶乘开方就直接进栈，如果栈不为空，此时扫描到的运算符与栈顶运算符做优先级比较，如果栈顶运算符优先级低于扫描的运算符，则当前扫描运算符入栈，否则栈顶运算符弹栈并放入字符数组中（接在上一个存的字符元素后），并与弹栈后的栈顶运算符再做比较，直到栈顶运算符低于当前扫描的运算符或遇到左括号，并将当前运算符进栈；当前运算符若是右括号，则将栈顶运算符依次弹出并依次放入字符数组中（接在上一个存的字符元素后），直到遇到左括号，并将左括号弹出(但是不连接放入字符数组中，注意后缀表达式中是没有括号的)。如果中缀表达式遍历完毕后栈中还有运算符则将栈中剩下的运算符依次弹出并连接在字符数组中（接在上一个存的字符元素后）；最终字符数组里存的就是后缀表达式。

#### (2) 后缀表达式的计算

先初始化一个栈，这个栈是用来存放操作数的，然后定义一个变量存放最后的结果。从存后缀表达式的字符数组中遍历到数字则依次进栈，遍历到操作符的时候将栈顶操作数弹出(假设赋给变量a，作为右操作数)，再将此时的栈顶操作数弹出(假设赋给变量b，作为左操作数)，用后者对前者做该操作符对应的运算(假设遍历当前的操作符为+,则做计算b+a)，然后将计算结果入栈。以此方式遍历整个字符数组，最终的结果即为运算结果。

##  4 功能模块设计

![image.png](https://cdn.nlark.com/yuque/0/2020/png/631670/1606034570607-a71a84b1-cae4-49e3-aa46-78de60733312.png#align=left&display=inline&height=994&margin=%5Bobject%20Object%5D&name=image.png&originHeight=994&originWidth=690&size=71173&status=done&style=none&width=690)
**

## 5 界面

![图片1.png](https://cdn.nlark.com/yuque/0/2020/png/631670/1606034325502-cda218f0-9731-4af0-aa06-191ef42f6c32.png#align=left&display=inline&height=377&margin=%5Bobject%20Object%5D&name=%E5%9B%BE%E7%89%871.png&originHeight=428&originWidth=335&size=8587&status=done&style=none&width=295)               ![图片2.png](https://cdn.nlark.com/yuque/0/2020/png/631670/1606034324765-28f91201-e401-448a-ae76-1a2fc0f15ee5.png#align=left&display=inline&height=266&margin=%5Bobject%20Object%5D&name=%E5%9B%BE%E7%89%872.png&originHeight=408&originWidth=552&size=14238&status=done&style=none&width=360)
